
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Store - Store</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#store" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Store" class="md-header__button md-logo" aria-label="Store" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Store
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Store
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/MobileNativeFoundation/Store" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    store
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Store" class="md-nav__button md-logo" aria-label="Store" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Store
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MobileNativeFoundation/Store" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    store
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Store
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Store
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fully-configured-store" class="md-nav__link">
    Fully Configured Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-store" class="md-nav__link">
    Creating a Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-interface-stream" class="md-nav__link">
    Public Interface - Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skipping-memorydisk" class="md-nav__link">
    Skipping Memory/Disk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" class="md-nav__link">
    Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inflight-debouncer" class="md-nav__link">
    Inflight Debouncer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-as-cache" class="md-nav__link">
    Disk as Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-as-single-source-of-truth" class="md-nav__link">
    Disk as Single Source of Truth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-in-memory-cache" class="md-nav__link">
    Configuring in-memory Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clearing-store-entries" class="md-nav__link">
    Clearing store entries
  </a>
  
    <nav class="md-nav" aria-label="Clearing store entries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#store-with-no-sourceoftruth" class="md-nav__link">
    Store with no sourceOfTruth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-with-sourceoftruth" class="md-nav__link">
    Store with sourceOfTruth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          MutableStore
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MutableStore" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          MutableStore
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Building a Mutable Store
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Building a Mutable Store" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Building a Mutable Store
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_2" type="checkbox" id="__nav_2_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_2">
          Defining Generics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Defining Generics" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Defining Generics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/generics/key" class="md-nav__link">
        Key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/generics/network" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/generics/common" class="md-nav__link">
        Common
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/generics/sot" class="md-nav__link">
        SOT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/generics/updater-result" class="md-nav__link">
        UpdaterResult
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_3" type="checkbox" id="__nav_2_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_3">
          Providing Implementations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Providing Implementations" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_3">
          <span class="md-nav__icon md-icon"></span>
          Providing Implementations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/fetcher" class="md-nav__link">
        Fetcher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/source-of-truth" class="md-nav__link">
        SourceOfTruth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/updater" class="md-nav__link">
        Updater
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/bookkeeper" class="md-nav__link">
        Bookkeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/validator" class="md-nav__link">
        Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/implementations/converter" class="md-nav__link">
        Converter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mutable-store/building/builder" class="md-nav__link">
        Bringing It All Together
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fully-configured-store" class="md-nav__link">
    Fully Configured Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-store" class="md-nav__link">
    Creating a Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-interface-stream" class="md-nav__link">
    Public Interface - Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skipping-memorydisk" class="md-nav__link">
    Skipping Memory/Disk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" class="md-nav__link">
    Stream
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inflight-debouncer" class="md-nav__link">
    Inflight Debouncer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-as-cache" class="md-nav__link">
    Disk as Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-as-single-source-of-truth" class="md-nav__link">
    Disk as Single Source of Truth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-in-memory-cache" class="md-nav__link">
    Configuring in-memory Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clearing-store-entries" class="md-nav__link">
    Clearing store entries
  </a>
  
    <nav class="md-nav" aria-label="Clearing store entries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#store-with-no-sourceoftruth" class="md-nav__link">
    Store with no sourceOfTruth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-with-sourceoftruth" class="md-nav__link">
    Store with sourceOfTruth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/MobileNativeFoundation/Store/edit/master/docs/store/store.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="store">Store</h1>
<h3 id="fully-configured-store">Fully Configured Store</h3>
<p>Let's start by looking at what a fully configured Store looks like. We will then walk through
simpler examples showing each piece:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="n">fetcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fetcher</span><span class="p">.</span><span class="na">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="na">fetchSubreddit</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;10&quot;</span><span class="p">).</span><span class="na">data</span><span class="p">.</span><span class="na">children</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="o">::</span><span class="n">toPosts</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="n">sourceOfTruth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceOfTruth</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">            </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">loadPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">            </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">insertPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">            </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearFeed</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">            </span><span class="n">deleteAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearAllFeeds</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="p">).</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>With the above setup you have:</p>
<ul>
<li>In-memory caching for rotation</li>
<li>Disk caching for when users are offline</li>
<li>Throttling of API calls when parallel requests are made for the same resource</li>
<li>Rich API to ask for data whether you want cached, new or a stream of future data updates.</li>
</ul>
<p>And now for the details:</p>
<h3 id="creating-a-store">Creating a Store</h3>
<p>You create a Store using a builder. The only requirement is to include a <code>Fetcher</code> which is just
a <code>typealias</code> to a function that returns a <code>Flow&lt;FetcherResult&lt;ReturnType&gt;&gt;</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Fetcher</span><span class="p">.</span><span class="na">ofFlow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">articleId</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="na">getArticle</span><span class="p">(</span><span class="n">articleId</span><span class="p">)</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// api returns Flow&lt;Article&gt;</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Store uses generic keys as identifiers for data. A key can be any value object that properly
implements <code>toString()</code>, <code>equals()</code> and <code>hashCode()</code>. When your <code>Fetcher</code> function is called, it
will be passed a particular <code>Key</code> value. Similarly, the key will be used as a primary identifier
within caches (Make sure to have a proper <code>hashCode()</code>!!).</p>
<p>Note: We highly recommend using built-in types that implement <code>equals</code> and <code>hashcode</code> or
Kotlin <code>data</code> classes for complex keys.</p>
<h3 id="public-interface-stream">Public Interface - Stream</h3>
<p>The primary function provided by a <code>Store</code> instance is the <code>stream</code> function which has the following
signature:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">StoreRequest</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">StoreResponse</span><span class="o">&lt;</span><span class="n">Output</span><span class="o">&gt;&gt;</span><span class="w"></span>
</code></pre></div>
<p>Each <code>stream</code> call receives a <code>StoreRequest</code> object, which defines which key to fetch and which data
sources to utilize.
The response is a <code>Flow</code> of <code>StoreResponse</code>. <code>StoreResponse</code> is a Kotlin sealed class that can be
either
a <code>Loading</code>, <code>Data</code> or <code>Error</code> instance.
Each <code>StoreResponse</code> includes an <code>origin</code> field which specifies where the event is coming from.</p>
<ul>
<li>The <code>Loading</code> class only has an <code>origin</code> field. This can provide you information like "network is
  fetching data", which can be a good signal to activate the loading spinner in your UI.</li>
<li>The <code>Data</code> class has a <code>value</code> field which includes an instance of the type returned by <code>Store</code>.</li>
<li>The <code>Error</code> class includes an <code>error</code> field that contains the exception thrown by the
  given <code>origin</code>.</li>
</ul>
<p>When an error happens, <code>Store</code> does not throw an exception, instead, it wraps it in
a <code>StoreResponse.Error</code> type which allows <code>Flow</code> to continue so that it can still receive updates
that might be triggered by either changes in your data source or subsequent fetch operations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">StoreRequest</span><span class="p">.</span><span class="na">cached</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)).</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">StoreResponse</span><span class="p">.</span><span class="na">Loading</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showLoadingSpinner</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">StoreResponse</span><span class="p">.</span><span class="na">Data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ResponseOrigin</span><span class="p">.</span><span class="na">Fetcher</span><span class="p">)</span><span class="w"> </span><span class="n">hideLoadingSpinner</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">                </span><span class="n">updateUI</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">value</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">StoreResponse</span><span class="p">.</span><span class="na">Error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ResponseOrigin</span><span class="p">.</span><span class="na">Fetcher</span><span class="p">)</span><span class="w"> </span><span class="n">hideLoadingSpinner</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                </span><span class="n">showError</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">error</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>For convenience, there are <code>Store.get(key)</code> and <code>Store.fresh(key)</code> extension functions.</p>
<ul>
<li><code>suspend fun Store.get(key: Key): Value</code>: This method returns a single value for the given key. If
  available, it will be returned from the in memory cache or the sourceOfTruth. An error will be
  thrown if no value is available in either the <code>cache</code> or <code>sourceOfTruth</code>, and the <code>fetcher</code> fails
  to load the data from the network.</li>
<li><code>suspend fun Store.fresh(key: Key): Value</code>: This method returns a single value for the given key
  that is obtained by querying the fetcher. An error will be thrown if the <code>fetcher</code> fails to load
  the data from the network, regardless of whether any value is available in the <code>cache</code>
  or <code>sourceOfTruth</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">lifecycleScope</span><span class="p">.</span><span class="na">launchWhenStarted</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">article</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">updateUI</span><span class="p">(</span><span class="n">article</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The first time you call to <code>suspend store.get(key)</code>, the response will be stored in an in-memory
cache and in the sourceOfTruth, if provided.
All subsequent calls to <code>store.get(key)</code> with the same <code>Key</code> will retrieve the cached version of the
data, minimizing unnecessary data calls. This prevents your app from fetching fresh data over the
network (or from another external data source) in situations when doing so would unnecessarily waste
bandwidth and battery. A great use case is any time your views are recreated after a rotation, they
will be able to request the cached data from your Store. Having this data available can help you
avoid the need to retain this in the view layer.</p>
<p>By default, 100 items will be cached in memory for 24 hours. You
may <a href="#Configuring-In-memory-Cache">pass in your own memory policy to override the default policy</a>.</p>
<h3 id="skipping-memorydisk">Skipping Memory/Disk</h3>
<p>Alternatively, you can call <code>store.fresh(key)</code> to get a <code>suspended result</code> that skips the memory (
and optional disk cache).</p>
<p>A good use case is overnight background updates use <code>fresh()</code> to make sure that calls
to <code>store.get()</code> will not have to hit the network during normal usage. Another good use case
for <code>fresh()</code> is when a user wants to pull to refresh.</p>
<p>Calls to both <code>fresh()</code> and <code>get()</code> emit one value or throw an error.</p>
<h3 id="stream">Stream</h3>
<p>For real-time updates, you may also call <code>store.stream()</code> which returns a <code>Flow&lt;T&gt;</code> that emits each
time a new item is returned from your store. You can think of stream as a way to create reactive
streams that update when you db or memory cache updates</p>
<p>example calls:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">lifecycleScope</span><span class="p">.</span><span class="na">launchWhenStarted</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">        </span><span class="n">StoreRequest</span><span class="p">.</span><span class="na">cached</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">            </span><span class="m">3</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">            </span><span class="n">refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="c1">//will get cached value followed by any fresh values, refresh will also trigger network call if set to `true` even if the data is available in cache or disk.</span><span class="w"></span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">StoreRequest</span><span class="p">.</span><span class="na">fresh</span><span class="p">(</span><span class="m">3</span><span class="p">))</span><span class="w"> </span><span class="c1">//skip cache, go directly to fetcher</span><span class="w"></span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="inflight-debouncer">Inflight Debouncer</h3>
<p>To prevent duplicate requests for the same data, Store offers an inflight debouncer. If the same
request is made as a previous identical request that has not completed, the same response will be
returned. This is useful for situations when your app needs to make many async calls for the same
data at startup or when users are obsessively pulling to refresh. As an example, The New York Times
news app asynchronously calls <code>ConfigStore.get()</code> from 12 different places on startup. The first
call blocks while all others wait for the data to arrive. We have seen a dramatic decrease in the
app's data usage after implementing this inflight logic.</p>
<h3 id="disk-as-cache">Disk as Cache</h3>
<p>Stores can enable disk caching by passing a <code>SourceOfTruth</code> into the builder. Whenever a new network
request is made, the Store will first write to the disk cache and then read from the disk cache.</p>
<h3 id="disk-as-single-source-of-truth">Disk as Single Source of Truth</h3>
<p>Providing <code>sourceOfTruth</code> whose <code>reader</code> function can return a <code>Flow&lt;Value?&gt;</code> allows you to make
Store treat your disk as source of truth.
Any changes made on disk, even if it is not made by Store, will update the active <code>Store</code> streams.</p>
<p>This feature, combined with persistence libraries that provide observable
queries (<a href="https://developer.android.com/jetpack/androidx/releases/room">Jetpack Room</a>
, <a href="https://github.com/cashapp/sqldelight">SQLDelight</a>
or <a href="https://realm.io/products/realm-database/">Realm</a>)
allows you to create offline first applications that can be used without an active network
connection while still providing a great user experience.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="n">fetcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fetcher</span><span class="p">.</span><span class="na">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="na">fetchSubreddit</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;10&quot;</span><span class="p">).</span><span class="na">data</span><span class="p">.</span><span class="na">children</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="o">::</span><span class="n">toPosts</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="n">sourceOfTruth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceOfTruth</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">            </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">loadPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">            </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">insertPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">            </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearFeed</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">            </span><span class="n">deleteAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearAllFeeds</span><span class="w"></span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="p">).</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Stores don’t care how you’re storing or retrieving your data from disk. As a result, you can use
Stores with object storage or any database (Realm, SQLite, CouchDB, Firebase etc). Technically,
there is nothing stopping you from implementing an in-memory cache for the "sourceOfTruth"
implementation and instead have two levels of in-memory caching--one with inflated and one with
deflated models, allowing for sharing of the “sourceOfTruth” cache data between stores.</p>
<p>If using SQLite we recommend working
with <a href="https://developer.android.com/topic/libraries/architecture/room">Room</a> which returns a <code>Flow</code>
from a query</p>
<p>The above builder is how we recommend working with data on Android. With the above setup you have:</p>
<ul>
<li>Memory caching with TTL &amp; Size policies</li>
<li>Disk caching with simple integration with Room</li>
<li>In-flight request management</li>
<li>Ability to get cached data or bust through your caches (<code>get()</code> vs. <code>fresh()</code>)</li>
<li>Ability to listen for any new emissions from network (stream)</li>
<li>Structured Concurrency through APIs build on Coroutines and Kotlin Flow</li>
</ul>
<h3 id="configuring-in-memory-cache">Configuring in-memory Cache</h3>
<p>You can configure in-memory cache with the <code>MemoryPolicy</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="n">fetcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fetcher</span><span class="p">.</span><span class="na">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="na">fetchSubreddit</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;10&quot;</span><span class="p">).</span><span class="na">data</span><span class="p">.</span><span class="na">children</span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="o">::</span><span class="n">toPosts</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="n">sourceOfTruth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceOfTruth</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">            </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">loadPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">            </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">insertPosts</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">            </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearFeed</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">            </span><span class="n">deleteAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="na">postDao</span><span class="p">()</span><span class="o">::</span><span class="n">clearAllFeeds</span><span class="w"></span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="p">).</span><span class="na">cachePolicy</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="n">MemoryPolicy</span><span class="p">.</span><span class="na">builder</span><span class="o">&lt;</span><span class="kt">Any</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">            </span><span class="p">.</span><span class="na">setMaxSize</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">            </span><span class="p">.</span><span class="na">setExpireAfterAccess</span><span class="p">(</span><span class="m">10.</span><span class="n">minutes</span><span class="p">)</span><span class="w"> </span><span class="c1">// or setExpireAfterWrite(10.minutes)</span><span class="w"></span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="p">).</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<ul>
<li><code>setMaxSize(maxSize: Long)</code> sets the maximum number of entries to be kept in the cache before
  starting to evict the least recently used items.</li>
<li><code>setExpireAfterAccess(expireAfterAccess: Duration)</code> sets the maximum time an entry can live in the
  cache since the last access, where "access" means reading the cache, adding a new cache entry, and
  replacing an existing entry with a new one. This duration is also known as <strong>time-to-idle (TTI)</strong>.</li>
<li><code>setExpireAfterWrite(expireAfterWrite: Duration)</code> sets the maximum time an entry can live in the
  cache since the last write, where "write" means adding a new cache entry and replacing an existing
  entry with a new one. This duration is also known as <strong>time-to-live (TTL)</strong>.</li>
</ul>
<p>Note that <code>setExpireAfterAccess</code> and <code>setExpireAfterWrite</code> <strong>cannot</strong> both be set at the same time.</p>
<h3 id="clearing-store-entries">Clearing store entries</h3>
<p>You can delete a specific entry by key from a store, or clear all entries in a store.</p>
<h4 id="store-with-no-sourceoftruth">Store with no sourceOfTruth</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="n">fetcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fetcher</span><span class="p">.</span><span class="na">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">            </span><span class="n">api</span><span class="p">.</span><span class="na">fetchData</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">        </span><span class="p">}).</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>The following will clear the entry associated with the key from the in-memory cache:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">store</span><span class="p">.</span><span class="na">clear</span><span class="p">(</span><span class="s">&quot;10&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>The following will clear all entries from the in-memory cache:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">store</span><span class="p">.</span><span class="na">clearAll</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<h4 id="store-with-sourceoftruth">Store with sourceOfTruth</h4>
<p>When store has a sourceOfTruth, you'll need to provide the <code>delete</code> and <code>deleteAll</code> functions
for <code>clear(key)</code> and <code>clearAll()</code> to work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">StoreBuilder</span><span class="w"></span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">        </span><span class="n">fetcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fetcher</span><span class="p">.</span><span class="na">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="na">fetchData</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="n">sourceOfTruth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceOfTruth</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">            </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="o">::</span><span class="n">loadData</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">            </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="o">::</span><span class="n">writeData</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">            </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="o">::</span><span class="n">clearDataByKey</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">            </span><span class="n">deleteAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="o">::</span><span class="n">clearAllData</span><span class="w"></span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="p">).</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>The following will clear the entry associated with the key from both the in-memory cache and the
sourceOfTruth:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">store</span><span class="p">.</span><span class="na">clear</span><span class="p">(</span><span class="s">&quot;myKey&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>The following will clear all entries from both the in-memory cache and the sourceOfTruth:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">store</span><span class="p">.</span><span class="na">clearAll</span><span class="p">()</span><span class="w"></span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
      
        
        <a href="../../mutable-store/building/overview/" class="md-footer__link md-footer__link--next" aria-label="Next: Overview" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2022 Mobile Native Foundation.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>